(function(f){function p(a,b,c){var h=c.relative?a.position().top:a.offset().top,d=c.relative?a.position().left:a.offset().left,i=c.position[0];h-=b.outerHeight()-c.offset[0];d+=a.outerWidth()+c.offset[1];if(/iPad/i.test(navigator.userAgent))h-=f(window).scrollTop();var j=b.outerHeight()+a.outerHeight();if(i=="center")h+=j/2;if(i=="bottom")h+=j;i=c.position[1];a=b.outerWidth()+a.outerWidth();if(i=="center")d-=a/2;if(i=="left")d-=a;return{top:h,left:d}}function u(a,b){var c=this,h=a.add(c),d,i=0,j=0,m=a.attr("title"),q=a.attr("data-tooltip"),r=o[b.effect],l,s=a.is(":input"),v=s&&a.is(":checkbox, :radio, select, :button, :submit"),t=a.attr("type"),k=b.events[t]||b.events[s?v?"widget":"input":"def"];if(!r)throw'Nonexistent effect "'+b.effect+'"';k=k.split(/,\s*/);if(k.length!=2)throw"Tooltip: bad events configuration for "+t;a.bind(k[0],function(e){clearTimeout(i);if(b.predelay)j=setTimeout(function(){c.show(e)},b.predelay);else c.show(e)}).bind(k[1],function(e){clearTimeout(j);if(b.delay)i=setTimeout(function(){c.hide(e)},b.delay);else c.hide(e)});if(m&&b.cancelDefault){a.removeAttr("title");a.data("title",m)}f.extend(c,{show:function(e){if(!d){if(q)d=f(q);else if(b.tip)d=f(b.tip).eq(0);else if(m)d=f(b.layout).addClass(b.tipClass).appendTo(document.body).hide().append(m);else{d=a.next();d.length||(d=a.parent().next())}if(!d.length)throw"Cannot find tooltip for "+a;}if(c.isShown())return c;d.stop(true,true);var g=p(a,d,b);b.tip&&d.html(a.data("title"));e=e||f.Event();e.type="onBeforeShow";h.trigger(e,[g]);if(e.isDefaultPrevented())return c;g=p(a,d,b);d.css({position:"absolute",top:g.top,left:g.left});l=true;r[0].call(c,function(){e.type="onShow";l="full";h.trigger(e)});g=b.events.tooltip.split(/,\s*/);if(!d.data("__set")){d.bind(g[0],function(){clearTimeout(i);clearTimeout(j)});g[1]&&!a.is("input:not(:checkbox, :radio), textarea")&&d.bind(g[1],function(n){n.relatedTarget!=a[0]&&a.trigger(k[1].split(" ")[0])});d.data("__set",true)}return c},hide:function(e){if(!d||!c.isShown())return c;e=e||f.Event();e.type="onBeforeHide";h.trigger(e);if(!e.isDefaultPrevented()){l=false;o[b.effect][1].call(c,function(){e.type="onHide";h.trigger(e)});return c}},isShown:function(e){return e?l=="full":l},getConf:function(){return b},getTip:function(){return d},getTrigger:function(){return a}});f.each("onHide,onBeforeShow,onShow,onBeforeHide".split(","),function(e,g){f.isFunction(b[g])&&f(c).bind(g,b[g]);c[g]=function(n){n&&f(c).bind(g,n);return c}})}f.tools=f.tools||{version:"1.2.5"};f.tools.tooltip={conf:{effect:"toggle",fadeOutSpeed:"fast",predelay:0,delay:30,opacity:1,tip:0,position:["top","center"],offset:[0,0],relative:false,cancelDefault:true,events:{def:"mouseenter,mouseleave",input:"focus,blur",widget:"focus mouseenter,blur mouseleave",tooltip:"mouseenter,mouseleave"},layout:"<div/>",tipClass:"tooltip"},addEffect:function(a,b,c){o[a]=[b,c]}};var o={toggle:[function(a){var b=this.getConf(),c=this.getTip();b=b.opacity;b<1&&c.css({opacity:b});c.show();a.call()},function(a){this.getTip().hide();a.call()}],fade:[function(a){var b=this.getConf();this.getTip().fadeTo(b.fadeInSpeed,b.opacity,a)},function(a){this.getTip().fadeOut(this.getConf().fadeOutSpeed,a)}]};f.fn.tooltip=function(a){var b=this.data("tooltip");if(b)return b;a=f.extend(true,{},f.tools.tooltip.conf,a);if(typeof a.position=="string")a.position=a.position.split(/,?\s/);this.each(function(){b=new u(f(this),a);f(this).data("tooltip",b)});return a.api?b:this}})(jQuery);(function(e){function p(f,c){var b=e(c);return b.length<2?b:f.parent().find(c)}function u(f,c){var b=this,n=f.add(b),g=f.children(),l=0,j=c.vertical;k||(k=b);if(g.length>1)g=e(c.items,f);e.extend(b,{getConf:function(){return c},getIndex:function(){return l},getSize:function(){return b.getItems().size()},getNaviButtons:function(){return o.add(q)},getRoot:function(){return f},getItemWrap:function(){return g},getItems:function(){return g.children(c.item).not("."+c.clonedClass)},move:function(a,d){return b.seekTo(l+
a,d)},next:function(a){return b.move(1,a)},prev:function(a){return b.move(-1,a)},begin:function(a){return b.seekTo(0,a)},end:function(a){return b.seekTo(b.getSize()-1,a)},focus:function(){return k=b},addItem:function(a){a=e(a);if(c.circular){g.children("."+c.clonedClass+":last").before(a);g.children("."+c.clonedClass+":first").replaceWith(a.clone().addClass(c.clonedClass))}else g.append(a);n.trigger("onAddItem",[a]);return b},seekTo:function(a,d,h){a.jquery||(a*=1);if(c.circular&&a===0&&l==-1&&d!==0)return b;if(!c.circular&&a<0||a>b.getSize()||a<-1)return b;var i=a;if(a.jquery)a=b.getItems().index(a);else i=b.getItems().eq(a);var r=e.Event("onBeforeSeek");if(!h){n.trigger(r,[a,d]);if(r.isDefaultPrevented()||!i.length)return b}i=j?{top:-i.position().top}:{left:-i.position().left};l=a;k=b;if(d===undefined)d=c.speed;g.animate(i,d,c.easing,h||function(){n.trigger("onSeek",[a])});return b}});e.each(["onBeforeSeek","onSeek","onAddItem"],function(a,d){e.isFunction(c[d])&&e(b).bind(d,c[d]);b[d]=function(h){h&&e(b).bind(d,h);return b}});if(c.circular){var s=b.getItems().slice(-1).clone().prependTo(g),t=b.getItems().eq(1).clone().appendTo(g);s.add(t).addClass(c.clonedClass);b.onBeforeSeek(function(a,d,h){if(!a.isDefaultPrevented())if(d==-1){b.seekTo(s,h,function(){b.end(0)});return a.preventDefault()}else d==b.getSize()&&b.seekTo(t,h,function(){b.begin(0)})});b.seekTo(0,0,function(){})}var o=p(f,c.prev).click(function(){b.prev()}),q=p(f,c.next).click(function(){b.next()});if(!c.circular&&b.getSize()>1){b.onBeforeSeek(function(a,d){setTimeout(function(){if(!a.isDefaultPrevented()){o.toggleClass(c.disabledClass,d<=0);q.toggleClass(c.disabledClass,d>=b.getSize()-1)}},1)});c.initialIndex||o.addClass(c.disabledClass)}c.mousewheel&&e.fn.mousewheel&&f.mousewheel(function(a,d){if(c.mousewheel){b.move(d<0?1:-1,c.wheelSpeed||50);return false}});if(c.touch){var m={};g[0].ontouchstart=function(a){a=a.touches[0];m.x=a.clientX;m.y=a.clientY};g[0].ontouchmove=function(a){if(a.touches.length==1&&!g.is(":animated")){var d=a.touches[0],h=m.x-d.clientX;d=m.y-d.clientY;b[j&&d>0||!j&&h>0?"next":"prev"]();a.preventDefault()}}}c.keyboard&&e(document).bind("keydown.scrollable",function(a){if(!(!c.keyboard||a.altKey||a.ctrlKey||e(a.target).is(":input")))if(!(c.keyboard!="static"&&k!=b)){var d=a.keyCode;if(j&&(d==38||d==40)){b.move(d==38?-1:1);return a.preventDefault()}if(!j&&(d==37||d==39)){b.move(d==37?-1:1);return a.preventDefault()}}});c.initialIndex&&b.seekTo(c.initialIndex,0,function(){})}e.tools=e.tools||{version:"1.2.5"};e.tools.scrollable={conf:{activeClass:"active",circular:false,clonedClass:"cloned",disabledClass:"disabled",easing:"swing",initialIndex:0,item:null,items:".items",keyboard:true,mousewheel:false,next:".next",prev:".prev",speed:400,vertical:false,touch:true,wheelSpeed:0}};var k;e.fn.scrollable=function(f){var c=this.data("scrollable");if(c)return c;f=e.extend({},e.tools.scrollable.conf,f);this.each(function(){c=new u(e(this),f);e(this).data("scrollable",c)});return f.api?c:this}})(jQuery);(function(a){function t(d,b){var c=this,j=d.add(c),o=a(window),k,f,m,g=a.tools.expose&&(b.mask||b.expose),n=Math.random().toString().slice(10);if(g){if(typeof g=="string")g={color:g};g.closeOnClick=g.closeOnEsc=false}var p=b.target||d.attr("rel");f=p?a(p):d;if(!f.length)throw"Could not find Overlay: "+p;d&&d.index(f)==-1&&d.click(function(e){c.load(e);return e.preventDefault()});a.extend(c,{load:function(e){if(c.isOpened())return c;var h=q[b.effect];if(!h)throw'Overlay: cannot find effect : "'+b.effect+'"';b.oneInstance&&a.each(s,function(){this.close(e)});e=e||a.Event();e.type="onBeforeLoad";j.trigger(e);if(e.isDefaultPrevented())return c;m=true;g&&a(f).expose(g);var i=b.top,r=b.left,u=f.outerWidth({margin:true}),v=f.outerHeight({margin:true});if(typeof i=="string")i=i=="center"?Math.max((o.height()-v)/2,0):parseInt(i,10)/100*o.height();if(r=="center")r=Math.max((o.width()-u)/2,0);h[0].call(c,{top:i,left:r},function(){if(m){e.type="onLoad";j.trigger(e)}});g&&b.closeOnClick&&a.mask.getMask().one("click",c.close);b.closeOnClick&&a(document).bind("click."+n,function(l){a(l.target).parents(f).length||c.close(l)});b.closeOnEsc&&a(document).bind("keydown."+n,function(l){l.keyCode==27&&c.close(l)});return c},close:function(e){if(!c.isOpened())return c;e=e||a.Event();e.type="onBeforeClose";j.trigger(e);if(!e.isDefaultPrevented()){m=false;q[b.effect][1].call(c,function(){e.type="onClose";j.trigger(e)});a(document).unbind("click."+n).unbind("keydown."+n);g&&a.mask.close();return c}},getOverlay:function(){return f},getTrigger:function(){return d},getClosers:function(){return k},isOpened:function(){return m},getConf:function(){return b}});a.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(e,h){a.isFunction(b[h])&&a(c).bind(h,b[h]);c[h]=function(i){i&&a(c).bind(h,i);return c}});k=f.find(b.close||".close");if(!k.length&&!b.close){k=a('<a class="close"></a>');f.prepend(k)}k.click(function(e){c.close(e)});b.load&&c.load()}a.tools=a.tools||{version:"1.2.5"};a.tools.overlay={addEffect:function(d,b,c){q[d]=[b,c]},conf:{close:null,closeOnClick:true,closeOnEsc:true,closeSpeed:"fast",effect:"default",fixed:!a.browser.msie||a.browser.version>6,left:"center",load:false,mask:null,oneInstance:true,speed:"normal",target:null,top:"10%"}};var s=[],q={};a.tools.overlay.addEffect("default",function(d,b){var c=this.getConf(),j=a(window);if(!c.fixed){d.top+=j.scrollTop();d.left+=j.scrollLeft()}d.position=c.fixed?"fixed":"absolute";this.getOverlay().css(d).fadeIn(c.speed,b)},function(d){this.getOverlay().fadeOut(this.getConf().closeSpeed,d)});a.fn.overlay=function(d){var b=this.data("overlay");if(b)return b;if(a.isFunction(d))d={onBeforeLoad:d};d=a.extend(true,{},a.tools.overlay.conf,d);this.each(function(){b=new t(a(this),d);s.push(b);a(this).data("overlay",b)});return d.api?b:this}})(jQuery);function showEmailOverlay(msg,label,header,email_type,link){$('#email_overlay').overlay({load:true,closeOnClick:false,top:'20%',left:'center',onBeforeLoad:function(){message=(link=="1")?msg+document.location.href:msg
$("#friend_invite_message_message").val(message);$('#msg_submit').text(label);$('#email_form_header').text(header);$('#email_type').val(email_type);}});$("#email_overlay").data("overlay").load();}
function likeComment(cid){commentId=cid.split("_")[1];elem=$("#"+cid);if(elem.hasClass("likeme")){meth="POST";url="/comment_likes";}else{meth="DELETE";url="/comment_likes/"+commentId;}
$.ajax({url:url,type:meth,dataType:'script',beforeSend:function(){elem.addClass("loading-link");},complete:function(){elem.removeClass("loading-link");},global:false,data:{comment_id:commentId}})}
function reloadHomeTab(){var selected=$("#home_tabs").tabs("option","selected");var selector="#ui-tabs-"+(selected+1);$(selector).animate({opacity:0},500,function(){}).animate({opacity:1},500,function(){});}
function configureVoteForm(maxVoteTopicHeaderLength,maxVoteTopicLength,maxVoteItemLength){$('.vote-form-more-details').live('click',function(){$('.vote-form-details').toggle(50,function(){var pos=$('.vote-form-details').position().top;$('.contentWrap').scrollTop(pos);});return false;});$('#vote_topic_header').keyup(function(){update_chars_left(maxVoteTopicHeaderLength,$('#vote_topic_header')[0],$('#vote_topic_header').next('p'));});$('#vote_topic_topic').keyup(function(){update_chars_left(maxVoteTopicLength,$('#vote_topic_topic')[0],$('#vote_topic_topic').next('p'));});$("input[id^='vote_topic_vote_items_attributes']").each(function(){$(this).keyup(function(){update_chars_left(maxVoteItemLength,$(this)[0],$(this).next('p'));})});$('#vote_submit').button({icons:{primary:'ui-icon-circle-check'}}).click(function(){$('#vote_topic_form').submit();return false;});$('#vote_topic_form').submit(function(){$.ajax({type:'POST',dataType:'script',url:$(this).attr('action'),data:$(this).serialize(),global:false,beforeSend:function(){showLoading("#form_loading")},complete:function(){hideLoading("#form_loading")}});return false;});}
var ModalVoteForm={init:function(){$("a[rel='#vote_overlay']").each(function(){$(this).overlay({closeOnClick:false,target:'#vote_overlay',fixed:false,onBeforeLoad:function(){var wrap=this.getOverlay().find(".contentWrap");wrap.load(this.getTrigger().attr("href"));},onLoad:function(){setTimeout("configureVoteForm(200, 1000, 150)",500);},onClose:function(){$('.contentWrap').empty();}});});},close:function(){$("a[rel='#vote_overlay']").each(function(){var ol=$(this).data("overlay");if(ol.isOpened()){ol.close();}});}};function removeSelected(){$("a.trig").each(function(){if($(this).parent('td').hasClass('act')){$(this).parent('td').removeClass('act');}});}
function handleCommentText(maxLength){$('#markItUp').keyup(function(){update_chars_left(maxLength,$('#comment_body')[0],$('#limit_status'));});}
function showProgress(elem){$(elem).show();}
function hideProgress(elem){$(elem).hide();}
function showLoading(elem){$(elem).show();$(elem).parent('div').animate({opacity:0.3},'slow',function(){});}
function hideLoading(elem){$(elem).hide();$(elem).parent('div').animate({opacity:1.0},'slow',function(){});}
function update_chars_left(max_len,target_input,display_element){var text_len=target_input.value.length;if(text_len>=max_len){target_input.value=target_input.value.substring(0,max_len);display_element.html("0 characters left");}else{display_element.html((max_len-text_len)+" characters left");}}
function setVotingCounter(inter){var resetVoteCount=setInterval(function(){$('#vote_count').val(0);hideFlash();},inter);}
function handleVoting(id){var sel_list=$("li:has(a.cancel)",'#vote_items_list_voted');if(sel_list.length==0){$("li[id^='v-item-']","#vote_items_list_voted").each(function(){anchor=$(this).children('a');if(anchor.attr('id')!=id){txt=anchor.text();anchor.remove();$(this).text(txt);}else{anchor.removeClass('vote').addClass('cancel');anchor.children('span').removeClass('ui-icon-check').addClass('ui-icon-close');}});}else{var selected_id=sel_list.children('a').attr('id');var txt=sel_list.text();if(selected_id!=id){sel_list.empty().text(txt);var new_selection=$('#v-item-'+id);var new_text=new_selection.text();new_selection.empty().append(makeCancelElement(id,new_text));}}
$('#vote_items_list_voted').show('slow');$('#vote_items_list_unvoted').hide('slow');}
function makeCancelElement(id,txt){var cancel_link=$("<a></a>").attr('class','cancel take-action').attr('id',id).attr('href','#');var cancel_button=$('<span></span>').attr('class','ui-icon ui-icon-close vote-icon');var cancel_element=cancel_link.append(cancel_button).append(txt);return cancel_element;}
function showFlashOverlay(msg,tp){$("#flash_overlay_message").addClass(tp).text(msg);$('#flash_overlay').addClass(tp);$('#flash_overlay').overlay({load:true,close:'#close_flash_overlay',closeOnClick:false,top:'30%',left:'center'});$("#flash_overlay").data("overlay").load();}
function showFlash(msg,tp){if($('#flash_messages_container').length>0){flashAnimatedHide();}
var flashContainer=$("<div id='flash_messages_container' class='flash-messages "+tp+" '></div>");flashContainer.prepend("<div id='flash_messages_content'>"+msg+"<span class='go-right closeb' id='close_flash'></span></div>");$('body').prepend(flashContainer);flashContainer.animate({opacity:.1},'500',function(){flashContainer.css('opacity',1)})
$('body').css('margin-top',flashContainer.outerHeight());posMenus();$('#close_flash').click(function(){flashAnimatedHide();$('body').css('margin-top','0');posMenus();});}
function flashAnimatedHide(){$('#flash_messages_container').remove();}
function hideFlash(){flashAnimatedHide();$('body').css('margin-top','0');posMenus();}
function prepareToolTip(){$('.t-trigger').each(function(){$(this).tooltip({relative:true,position:"top center",cancelDefault:true});});}
function posMenus(){if($('.main_links_div').length>0){var selector=".main_links_div";var headerSelector=".header"
var pos=$(selector).offset();var width=$(headerSelector).width();var height=$(selector).outerHeight();$("#cat_menu").css({"left":(pos.left)+"px","top":(pos.top+height)+"px"});$("#city_menu").css({"left":(pos.left)+"px","top":(pos.top+height)+"px"});}}
function showMenu(){if($('#city_nav a').hasClass('hover-nav')){$('#city_nav a').removeClass('hover-nav');$('#city_menu').toggle('fast');}
$('#cat_nav a').toggleClass('hover-nav');$("#cat_menu").toggle('fast');}
function showCityMenu(){if($('#cat_nav a').hasClass('hover-nav')){$('#cat_nav a').removeClass('hover-nav');$('#cat_menu').toggle('fast');}
$('#city_nav a').toggleClass('hover-nav');$("#city_menu").toggle('fast');}
$(document).ready(function(){setTimeout(prepareToolTip,500);$(document).bind('ajaxComplete',function(){prepareToolTip();});posMenus();$('#comment_submit').button({icons:{primary:'ui-icon-comment'}}).click(function(){$('#new_comment').submit();return false;});$('#new_comment').submit(function(){showLoading('#com_submit_loading');$.post($(this).attr('action'),$(this).serialize(),function(data){hideLoading('#com_submit_loading');},"script");return false;});$('#new_vote_btn').button({icons:{primary:'ui-icon-lightbulb'}});$('#search_term').focus(function(){$(this).val('');});$("#search_form a").click(function(){$(this).parents().filter("form").trigger("submit");});$('#search_button').button({icons:{primary:'ui-icon-search'},text:false});$("#cat_nav").bind('click',function(){showMenu();return false;});$("#city_nav").bind('click',function(){showCityMenu();return false;});if($('.load-widget-link').length>0){$('.load-widget-link').each(function(){$.ajax({type:'GET',url:$(this).attr('href'),dataType:'script',global:true,context:$(this),success:function(){$(this).parent('div').slideDown('slow',function(){});}});});}
$('#close_cat_menu').click(function(){$('#cat_nav a').toggleClass('hover-nav');$("#cat_menu").toggle('fast');});$('#close_city_menu').click(function(){$('#city_nav a').toggleClass('hover-nav');$("#city_menu").toggle('fast');});$('#search_term').focus(function(){$(this).val('');});$("#search_form a").click(function(){$(this).parents().filter("form").trigger("submit");});$('#search_button').button({icons:{primary:'ui-icon-search'},text:false});ModalVoteForm.init();$("a[rel='#intro_prezo']").overlay({top:"center"});if($.cookie('show_voteable_intro')=='1'){$("a[rel='#intro_prezo']").click();$.cookie('show_voteable_intro','0')}
setInterval(reloadHomeTab,10000);if($('#msg_close').length>0){$("#msg_close").click(function(){$("#email_overlay").data("overlay").close();return false;})}});jQuery.cookie=function(key,value,options){if(arguments.length>1&&(value===null||typeof value!=="object")){options=jQuery.extend({},options);if(value===null){options.expires=-1;}
if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}
return(document.cookie=[encodeURIComponent(key),'=',options.raw?String(value):encodeURIComponent(String(value)),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
options=value||{};var result,decode=options.raw?function(s){return s;}:decodeURIComponent;return(result=new RegExp('(?:^|; )'+encodeURIComponent(key)+'=([^;]*)').exec(document.cookie))?decode(result[1]):null;};(function($){$.fn.editable=function(target,options){if('disable'==target){$(this).data('disabled.editable',true);return;}
if('enable'==target){$(this).data('disabled.editable',false);return;}
if('destroy'==target){$(this).unbind($(this).data('event.editable')).removeData('disabled.editable').removeData('event.editable');return;}
var settings=$.extend({},$.fn.editable.defaults,{target:target},options);var plugin=$.editable.types[settings.type].plugin||function(){};var submit=$.editable.types[settings.type].submit||function(){};var buttons=$.editable.types[settings.type].buttons||$.editable.types['defaults'].buttons;var content=$.editable.types[settings.type].content||$.editable.types['defaults'].content;var element=$.editable.types[settings.type].element||$.editable.types['defaults'].element;var reset=$.editable.types[settings.type].reset||$.editable.types['defaults'].reset;var callback=settings.callback||function(){};var onedit=settings.onedit||function(){};var onsubmit=settings.onsubmit||function(){};var onreset=settings.onreset||function(){};var onerror=settings.onerror||reset;if(settings.tooltip){$(this).attr('title',settings.tooltip);}
settings.autowidth='auto'==settings.width;settings.autoheight='auto'==settings.height;return this.each(function(){var self=this;var savedwidth=$(self).width();var savedheight=$(self).height();$(this).data('event.editable',settings.event);if(!$.trim($(this).html())){$(this).html(settings.placeholder);}
$(this).bind(settings.event,function(e){if(true===$(this).data('disabled.editable')){return;}
if(self.editing){return;}
if(false===onedit.apply(this,[settings,self])){return;}
e.preventDefault();e.stopPropagation();if(settings.tooltip){$(self).removeAttr('title');}
if(0==$(self).width()){settings.width=savedwidth;settings.height=savedheight;}else{if(settings.width!='none'){settings.width=settings.autowidth?$(self).width():settings.width;}
if(settings.height!='none'){settings.height=settings.autoheight?$(self).height():settings.height;}}
if($(this).html().toLowerCase().replace(/(;|")/g,'')==settings.placeholder.toLowerCase().replace(/(;|")/g,'')){$(this).html('');}
self.editing=true;self.revert=$(self).html();$(self).html('');var form=$('<form />');if(settings.cssclass){if('inherit'==settings.cssclass){form.attr('class',$(self).attr('class'));}else{form.attr('class',settings.cssclass);}}
if(settings.style){if('inherit'==settings.style){form.attr('style',$(self).attr('style'));form.css('display',$(self).css('display'));}else{form.attr('style',settings.style);}}
var input=element.apply(form,[settings,self]);var input_content;if(settings.loadurl){var t=setTimeout(function(){input.disabled=true;content.apply(form,[settings.loadtext,settings,self]);},100);var loaddata={};loaddata[settings.id]=self.id;if($.isFunction(settings.loaddata)){$.extend(loaddata,settings.loaddata.apply(self,[self.revert,settings]));}else{$.extend(loaddata,settings.loaddata);}
$.ajax({type:settings.loadtype,url:settings.loadurl,data:loaddata,async:false,success:function(result){window.clearTimeout(t);input_content=result;input.disabled=false;}});}else if(settings.data){input_content=settings.data;if($.isFunction(settings.data)){input_content=settings.data.apply(self,[self.revert,settings]);}}else{input_content=self.revert;}
content.apply(form,[input_content,settings,self]);input.attr('name',settings.name);buttons.apply(form,[settings,self]);$(self).append(form);plugin.apply(form,[settings,self]);$(':input:visible:enabled:first',form).focus();if(settings.select){input.select();}
input.keydown(function(e){if(e.keyCode==27){e.preventDefault();reset.apply(form,[settings,self]);}});var t;if('cancel'==settings.onblur){input.blur(function(e){t=setTimeout(function(){reset.apply(form,[settings,self]);},500);});}else if('submit'==settings.onblur){input.blur(function(e){t=setTimeout(function(){form.submit();},200);});}else if($.isFunction(settings.onblur)){input.blur(function(e){settings.onblur.apply(self,[input.val(),settings]);});}else{input.blur(function(e){});}
form.submit(function(e){if(t){clearTimeout(t);}
e.preventDefault();if(false!==onsubmit.apply(form,[settings,self])){if(false!==submit.apply(form,[settings,self])){if($.isFunction(settings.target)){var str=settings.target.apply(self,[input.val(),settings]);$(self).html(str);self.editing=false;callback.apply(self,[self.innerHTML,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder);}}else{var submitdata={};submitdata[settings.name]=input.val();submitdata[settings.id]=self.id;if($.isFunction(settings.submitdata)){$.extend(submitdata,settings.submitdata.apply(self,[self.revert,settings]));}else{$.extend(submitdata,settings.submitdata);}
if('PUT'==settings.method){submitdata['_method']='put';}
$(self).html(settings.indicator);var ajaxoptions={type:'POST',data:submitdata,dataType:'html',url:settings.target,success:function(result,status){if(ajaxoptions.dataType=='html'){$(self).html(result);}
self.editing=false;callback.apply(self,[result,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder);}},error:function(xhr,status,error){onerror.apply(form,[settings,self,xhr]);}};$.extend(ajaxoptions,settings.ajaxoptions);$.ajax(ajaxoptions);}}}
$(self).attr('title',settings.tooltip);return false;});});this.reset=function(form){if(this.editing){if(false!==onreset.apply(form,[settings,self])){$(self).html(self.revert);self.editing=false;if(!$.trim($(self).html())){$(self).html(settings.placeholder);}
if(settings.tooltip){$(self).attr('title',settings.tooltip);}}}};});};$.editable={types:{defaults:{element:function(settings,original){var input=$('<input type="hidden"></input>');$(this).append(input);return(input);},content:function(string,settings,original){$(':input:first',this).val(string);},reset:function(settings,original){original.reset(this);},buttons:function(settings,original){var form=this;if(settings.submit){if(settings.submit.match(/>$/)){var submit=$(settings.submit).click(function(){if(submit.attr("type")!="submit"){form.submit();}});}else{var submit=$('<button type="submit" />');submit.html(settings.submit);}
$(this).append(submit);}
if(settings.cancel){if(settings.cancel.match(/>$/)){var cancel=$(settings.cancel);}else{var cancel=$('<button type="cancel" />');cancel.html(settings.cancel);}
$(this).append(cancel);$(cancel).click(function(event){if($.isFunction($.editable.types[settings.type].reset)){var reset=$.editable.types[settings.type].reset;}else{var reset=$.editable.types['defaults'].reset;}
reset.apply(form,[settings,original]);return false;});}}},text:{element:function(settings,original){var input=$('<input />');if(settings.width!='none'){input.width(settings.width);}
if(settings.height!='none'){input.height(settings.height);}
input.attr('autocomplete','off');$(this).append(input);return(input);}},textarea:{element:function(settings,original){var textarea=$('<textarea />');if(settings.rows){textarea.attr('rows',settings.rows);}else if(settings.height!="none"){textarea.height(settings.height);}
if(settings.cols){textarea.attr('cols',settings.cols);}else if(settings.width!="none"){textarea.width(settings.width);}
$(this).append(textarea);return(textarea);}},select:{element:function(settings,original){var select=$('<select />');$(this).append(select);return(select);},content:function(data,settings,original){if(String==data.constructor){eval('var json = '+data);}else{var json=data;}
for(var key in json){if(!json.hasOwnProperty(key)){continue;}
if('selected'==key){continue;}
var option=$('<option />').val(key).append(json[key]);$('select',this).append(option);}
$('select',this).children().each(function(){if($(this).val()==json['selected']||$(this).text()==$.trim(original.revert)){$(this).attr('selected','selected');}});}}},addInputType:function(name,input){$.editable.types[name]=input;}};$.fn.editable.defaults={name:'value',id:'id',type:'text',width:'auto',height:'auto',event:'click.editable',onblur:'cancel',loadtype:'GET',loadtext:'Loading...',placeholder:'Click to edit',loaddata:{},submitdata:{},ajaxoptions:{}};})(jQuery);function TextileEditorButton(id,display,tagStart,tagEnd,access,title,sve,open){this.id=id;this.display=display;this.tagStart=tagStart;this.tagEnd=tagEnd;this.access=access;this.title=title;this.sve=sve;this.open=open;this.standard=true;}
function TextileEditorButtonSeparator(sve){this.separator=true;this.sve=sve;}
var TextileEditor=function(){};TextileEditor.buttons=new Array();TextileEditor.Methods={initialize:function(canvas,view){var toolbar=document.createElement("div");toolbar.id="textile-toolbar-"+canvas;toolbar.className='textile-toolbar';this.canvas=document.getElementById(canvas);this.canvas.parentNode.insertBefore(toolbar,this.canvas);this.openTags=new Array();var edButtons=new Array();edButtons=this.buttons;var standardButtons=new Array();for(var i=0;i<edButtons.length;i++){var thisButton=this.prepareButton(edButtons[i]);if(view=='s'){if(edButtons[i].sve=='s'){toolbar.appendChild(thisButton);standardButtons.push(thisButton);}}else{if(typeof thisButton=='string'){toolbar.innerHTML+=thisButton;}else{toolbar.appendChild(thisButton);standardButtons.push(thisButton);}}}
var te=this;var buttons=toolbar.getElementsByTagName('button');for(var i=0;i<buttons.length;i++){if(!buttons[i].onclick){buttons[i].onclick=function(){te.insertTag(this);return false;}}
buttons[i].tagStart=buttons[i].getAttribute('tagStart');buttons[i].tagEnd=buttons[i].getAttribute('tagEnd');buttons[i].open=buttons[i].getAttribute('open');buttons[i].textile_editor=te;buttons[i].canvas=te.canvas;}},prepareButton:function(button){if(button.separator){var theButton=document.createElement('span');theButton.className='ed_sep';return theButton;}
if(button.standard){var theButton=document.createElement("button");theButton.id=button.id;theButton.setAttribute('class','standard');theButton.setAttribute('tagStart',button.tagStart);theButton.setAttribute('tagEnd',button.tagEnd);theButton.setAttribute('open',button.open);var img=document.createElement('img');img.src='/images/textile-editor/'+button.display;theButton.appendChild(img);}else{return button;}
theButton.accessKey=button.access;theButton.title=button.title;return theButton;},addTag:function(button){if(button.tagEnd!=''){this.openTags[this.openTags.length]=button;button.className='selected';}},removeTag:function(button){for(i=0;i<this.openTags.length;i++){if(this.openTags[i]==button){this.openTags.splice(button,1);button.className='unselected';}}},checkOpenTags:function(button){var tag=0;for(i=0;i<this.openTags.length;i++){if(this.openTags[i]==button){tag++;}}
if(tag>0){return true;}
else{return false;}},insertTag:function(button,tagStart,tagEnd){var myField=button.canvas;myField.focus();if(tagStart){button.tagStart=tagStart;button.tagEnd=tagEnd?tagEnd:'\n';}
var textSelected=false;var finalText='';var FF=false;if(document.selection){sel=document.selection.createRange();var beginningText='';var followupText='';var selectedText=sel.text;if(sel.text.length>0){textSelected=true;}
var newlineReplaceRegexClean=/\r\n\s\n/g;var newlineReplaceRegexDirty='\\r\\n\\s\\n';var newlineReplaceClean='\r\n\n';}
else if(myField.selectionStart||myField.selectionStart=='0'){var startPos=myField.selectionStart;var endPos=myField.selectionEnd;var cursorPos=endPos;var scrollTop=myField.scrollTop;FF=true;var beginningText=myField.value.substring(0,startPos);var followupText=myField.value.substring(endPos,myField.value.length);if(startPos!=endPos){textSelected=true;var selectedText=myField.value.substring(startPos,endPos);}
var newlineReplaceRegexClean=/\n\n/g;var newlineReplaceRegexDirty='\\n\\n';var newlineReplaceClean='\n\n';}
if(textSelected){var newlineStart='';var newlineStartPos=0;var newlineEnd='';var newlineEndPos=0;var newlineFollowup='';var posDiffPos=0;var posDiffNeg=0;var mplier=1;if(selectedText.match(/^\n/)){selectedText=selectedText.replace(/^\n/,'');newlineStart='\n';newlineStartpos=1;}
if(selectedText.match(/\n$/g)){selectedText=selectedText.replace(/\n$/g,'');newlineEnd='\n';newlineEndPos=1;}
if(selectedText.match(/\s$/g)){selectedText=selectedText.replace(/\s$/g,'');followupText=' ';}
if(followupText.match(/^\n/)){newlineFollowup='';}
else{newlineFollowup='\n\n';}
if((button.tagStart==' * ')||(button.tagStart==' # ')){listItems=0;re_start=new RegExp('^ (\\*|\\#) ','g');if(button.tagStart==' # '){re_tag=new RegExp(' \\# ','g');}
else{re_tag=new RegExp(' \\* ','g');}
re_replace=new RegExp(' (\\*|\\#) ','g');re_word_bullet_m_s=new RegExp('• ','g');re_word_bullet_m_f=new RegExp('∑ ','g');selectedText=selectedText.replace(re_word_bullet_m_s,'').replace(re_word_bullet_m_f,'');if(selectedText.match(re_start)){if(selectedText.match(re_tag)){finalText=beginningText
+newlineStart
+selectedText.replace(re_replace,'')
+newlineEnd
+followupText;if(matches=selectedText.match(/ (\*|\#) /g)){listItems=matches.length;}
posDiffNeg=listItems*3;}
else{finalText=beginningText
+newlineStart
+selectedText.replace(re_replace,button.tagStart)
+newlineEnd
+followupText;}}
else{finalText=beginningText
+newlineStart
+button.tagStart
+selectedText.replace(newlineReplaceRegexClean,newlineReplaceClean+button.tagStart).replace(/\n(\S)/g,'\n'+button.tagStart+'$1')
+newlineEnd
+followupText;if(matches=selectedText.match(/\n(\S)/g)){listItems=matches.length;}
posDiffPos=3+listItems*3;}}
else if(button.tagStart.match(/^(h1|h2|h3|h4|h5|h6|bq|p|\>|\<\>|\<|\=|\(|\))/g)){var insertTag='';var insertModifier='';var tagPartBlock='';var tagPartModifier='';var tagPartModifierOrig='';var drawSwitch='';var captureIndentStart=false;var captureListStart=false;var periodAddition='\\. ';var periodAdditionClean='. ';var listItemsAddition=0;var re_list_items=new RegExp('(\\*+|\\#+)','g');var re_block_modifier=new RegExp('^(h1|h2|h3|h4|h5|h6|bq|p| [\\*]{1,} | [\\#]{1,} |)(\\>|\\<\\>|\\<|\\=|[\\(]{1,}|[\\)]{1,6}|)','g');if(tagPartMatches=re_block_modifier.exec(selectedText)){tagPartBlock=tagPartMatches[1];tagPartModifier=tagPartMatches[2];tagPartModifierOrig=tagPartMatches[2];tagPartModifierOrig=tagPartModifierOrig.replace(/\(/g,"\\(");}
if(tagPartBlock==button.tagStart){insertTag=tagPartBlock+tagPartModifierOrig;drawSwitch=0;}
else if((tagPartModifier==button.tagStart)||(newm=tagPartModifier.match(/[\(]{2,}/g))){if((button.tagStart=='(')||(button.tagStart==')')){var indentLength=tagPartModifier.length;if(button.tagStart=='('){indentLength=indentLength+1;}
else{indentLength=indentLength-1;}
for(var i=0;i<indentLength;i++){insertModifier=insertModifier+'(';}
insertTag=tagPartBlock+insertModifier;}
else{if(button.tagStart==tagPartModifier){insertTag=tagPartBlock;}
else{if(button.tagStart.match(/(\>|\<\>|\<|\=)/g)){insertTag=tagPartBlock+button.tagStart;}
else{insertTag=button.tagStart+tagPartModifier;}}}
drawSwitch=1;}
else if(listPartMatches=re_list_items.exec(tagPartBlock)){var listTypeMatch=listPartMatches[1];var indentLength=tagPartBlock.length-2;var listInsert='';if(button.tagStart=='('){indentLength=indentLength+1;}
else{indentLength=indentLength-1;}
if(listTypeMatch.match(/[\*]{1,}/g)){var listType='*';var listReplace='\\*';}
else{var listType='#';var listReplace='\\#';}
for(var i=0;i<indentLength;i++){listInsert=listInsert+listType;}
if(listInsert!=''){insertTag=' '+listInsert+' ';}
else{insertTag='';}
tagPartBlock=tagPartBlock.replace(/(\*|\#)/g,listReplace);drawSwitch=1;captureListStart=true;periodAddition='';periodAdditionClean='';if(matches=selectedText.match(/\n\s/g)){listItemsAddition=matches.length;}}
else{if(button.tagStart.match(/(h1|h2|h3|h4|h5|h6|bq|p)/g)){if(tagPartBlock==''){drawSwitch=2;}
else{drawSwitch=1;}
insertTag=button.tagStart+tagPartModifier;}
else{if((tagPartModifier=='')&&(tagPartBlock!='')){drawSwitch=1;}
else if(tagPartModifier==''){drawSwitch=2;}
else{drawSwitch=1;}
if(tagPartBlock==''){tagPartBlock='p';}
if(button.tagStart==')'){tagPartModifier='';}
else{tagPartModifier=button.tagStart;captureIndentStart=true;}
insertTag=tagPartBlock+tagPartModifier;}}
mplier=0;if(captureListStart||(tagPartModifier.match(/[\(\)]{1,}/g))){re_start=new RegExp(insertTag.escape+periodAddition,'g');}
else{re_start=new RegExp(insertTag+periodAddition,'g');}
re_old=new RegExp(tagPartBlock+tagPartModifierOrig+periodAddition,'g');re_middle=new RegExp(newlineReplaceRegexDirty+insertTag.escape+periodAddition.escape,'g');re_tag=new RegExp(insertTag.escape+periodAddition.escape,'g');if((drawSwitch==0)||(drawSwitch==1)){if(drawSwitch==0){finalText=beginningText
+newlineStart
+selectedText.replace(re_start,'').replace(re_middle,newlineReplaceClean)
+newlineEnd
+followupText;if(matches=selectedText.match(newlineReplaceRegexClean)){mplier=mplier+matches.length;}
posDiffNeg=insertTag.length+2+(mplier*4);}
else{finalText=beginningText
+newlineStart
+selectedText.replace(re_old,insertTag+periodAdditionClean)
+newlineEnd
+followupText;if(matches=selectedText.match(newlineReplaceRegexClean)){mplier=mplier+matches.length;}
if(captureIndentStart){tagPreviousLength=tagPartBlock.length;tagCurrentLength=insertTag.length;}
else if(captureListStart){if(button.tagStart=='('){tagPreviousLength=listTypeMatch.length+2;tagCurrentLength=insertTag.length+listItemsAddition;}
else if(insertTag.match(/(\*|\#)/g)){tagPreviousLength=insertTag.length+listItemsAddition;tagCurrentLength=listTypeMatch.length;}
else{tagPreviousLength=insertTag.length+listItemsAddition;tagCurrentLength=listTypeMatch.length-(3*listItemsAddition)-1;}}
else{tagPreviousLength=tagPartBlock.length+tagPartModifier.length;tagCurrentLength=insertTag.length;}
if(tagCurrentLength>tagPreviousLength){posDiffPos=(tagCurrentLength-tagPreviousLength)+(mplier*(tagCurrentLength-tagPreviousLength));}
else{posDiffNeg=(tagPreviousLength-tagCurrentLength)+(mplier*(tagPreviousLength-tagCurrentLength));}}}
else{finalText=beginningText
+newlineStart
+insertTag+'. '
+selectedText.replace(newlineReplaceRegexClean,button.tagEnd+'\n'+insertTag+'. ')
+newlineFollowup
+newlineEnd
+followupText;if(matches=selectedText.match(newlineReplaceRegexClean)){mplier=mplier+matches.length;}
posDiffPos=insertTag.length+2+(mplier*4);}}
else{mplier=1;re_start=new RegExp('^\\'+button.tagStart,'g');re_end=new RegExp('\\'+button.tagEnd+'$','g');re_middle=new RegExp('\\'+button.tagEnd+newlineReplaceRegexDirty+'\\'+button.tagStart,'g');if(selectedText.match(re_start)&&selectedText.match(re_end)){finalText=beginningText
+newlineStart
+selectedText.replace(re_start,'').replace(re_end,'').replace(re_middle,newlineReplaceClean)
+newlineEnd
+followupText;if(matches=selectedText.match(newlineReplaceRegexClean)){mplier=mplier+matches.length;}
posDiffNeg=button.tagStart.length*mplier+button.tagEnd.length*mplier;}
else{finalText=beginningText
+newlineStart
+button.tagStart
+selectedText.replace(newlineReplaceRegexClean,button.tagEnd+newlineReplaceClean+button.tagStart)
+button.tagEnd
+newlineEnd
+followupText;if(matches=selectedText.match(newlineReplaceRegexClean)){mplier=mplier+matches.length;}
posDiffPos=(button.tagStart.length*mplier)+(button.tagEnd.length*mplier);}}
cursorPos+=button.tagStart.length+button.tagEnd.length;}
else{var buttonStart='';var buttonEnd='';var re_p=new RegExp('(\\<|\\>|\\=|\\<\\>|\\(|\\))','g');var re_h=new RegExp('^(h1|h2|h3|h4|h5|h6|p|bq)','g');if(!this.checkOpenTags(button)||button.tagEnd==''){if(button.tagStart.match(re_h)){buttonStart=button.tagStart+'. ';}
else{buttonStart=button.tagStart;}
if(button.tagStart.match(re_p)){finalText=beginningText
+followupText;cursorPos=startPos;}
else{finalText=beginningText
+buttonStart
+followupText;this.addTag(button);cursorPos=startPos+buttonStart.length;}}
else{if(button.tagStart.match(re_p)){buttonEnd='\n\n';}
else if(button.tagStart.match(re_h)){buttonEnd='\n\n';}
else{buttonEnd=button.tagEnd}
finalText=beginningText
+button.tagEnd
+followupText;this.removeTag(button);cursorPos=startPos+button.tagEnd.length;}}
if(FF==true){myField.value=finalText;myField.scrollTop=scrollTop;}
else{sel.text=finalText;}
if(textSelected){myField.selectionStart=startPos+newlineStartPos;myField.selectionEnd=endPos+posDiffPos-posDiffNeg-newlineEndPos;}
else{myField.selectionStart=cursorPos;myField.selectionEnd=cursorPos;}}};destination=TextileEditor
source=TextileEditor.Methods
for(var property in source)destination[property]=source[property];document.write('<script src="/javascripts/textile-editor-config.js" type="text/javascript"></script>');var teButtons=TextileEditor.buttons;teButtons.push(new TextileEditorButton('ed_strong','bold.png','*','*','b','Bold','s'));teButtons.push(new TextileEditorButton('ed_emphasis','italic.png','_','_','i','Italicize','s'));teButtons.push(new TextileEditorButton('ed_underline','underline.png','+','+','u','Underline','s'));teButtons.push(new TextileEditorButton('ed_strike','strikethrough.png','-','-','s','Strikethrough','s'));teButtons.push(new TextileEditorButton('ed_ol','list_numbers.png',' # ','\n',',','Numbered List'));teButtons.push(new TextileEditorButton('ed_ul','list_bullets.png',' * ','\n','.','Bulleted List'));teButtons.push(new TextileEditorButton('ed_p','paragraph.png','p','\n','p','Paragraph'));teButtons.push(new TextileEditorButton('ed_outdent','outdent.png',')','\n',']','Outdent'));teButtons.push(new TextileEditorButton('ed_indent','indent.png','(','\n','[','Indent'));teButtons.push(new TextileEditorButton('ed_justifyl','left.png','<','\n','l','Left Justify'));teButtons.push(new TextileEditorButton('ed_justifyc','center.png','=','\n','e','Center Text'));teButtons.push(new TextileEditorButton('ed_justifyr','right.png','>','\n','r','Right Justify'));teButtons.push(new TextileEditorButton('ed_justify','justify.png','<>','\n','j','Justify'));