<%= javascript_include_tag  'jquery.simpleSlide_min.js'  %>
<script type="text/javascript">
  //<![CDATA[
  $(document).ready(function() {
    //Load the remaining pictures
    
    $.ajax({
      url:"<%= breakdown_vote_topic_url(@vote_topic)%>",
      data: {bd_type: "other", id: "<%= @vote_topic.id %>"},
      success:function(){hideLoading('#pic_loading_g');},
      beforeSend:function(xhr) {showLoading('#pic_loading_g');},
      dataType: "script"
    });
    
    /** $(window).scroll(function(){
      if  ($(window).scrollTop() == $(document).height() - $(window).height()){
        //lastPostFunc();
        alert('at bottom');
      }
    });**/
    simpleSlide({
      'set_speed': 300,
      'status_width': 120,
      'status_color_outside': 'rgb(170, 10, 172)',
      'status_color_inside': '#ffe',
      'callback': function() {
        /* function code */
      }
    });
    $('.slideshow').live('mouseover mouseout', function(event) {
      if(event.type == 'mouseover'){
        $(this).children('.left-button, .right-button').stop(true, true).fadeIn();
      }
      else {
        $(this).children('.left-button, .right-button').stop(true, true).fadeOut();
      }
    });

    $('#vote_link').click(function() {
      $('#vote_form').submit();
      return false;
    });

    $('#comment_submit').click(function() {
      $('#new_comment').submit();
      return false;
    });
    
    $('#vote_form').submit(function (){
      $.post($(this).attr('action'), $(this).serialize(), null, "script");
      return false;
    });
    $('#new_comment').submit(function (){
      showLoading('#com_prog_loading')
      $.post($(this).attr('action'), $(this).serialize(), function(data) {
        hideLoading('#com_prog_loading');
      }, "script");
      return false;
    });

  });
  //]]>
</script>

<div id="div_vote_form" >
  <%vote_items = @vote_topic.vote_items if !@vote_topic.nil?%>
  <%if current_user && !vote_items.nil? && !@vote_topic.is_vote_complete?(vote_items, current_user)%>
    <h2><%= @vote_topic.header %></h2>
    <h4><%= @vote_topic.topic %></h4>
    <% form_tag process_votes_vote_topic_path(@vote_topic, :user_id => current_user.id), :id => "vote_form" do |f| %>
      <%= hidden_field_tag :user_id, current_user.id %>
      <ul class="list_no_pad_no_style">
        <% vote_items.each do |v| %>
          <li>
            <%= radio_button_tag "response", v.id %>
            <%= label_tag v.option %>
          </li>
        <% end %>
      </ul>
      <ul class="list_no_pad_no_style">
        <li>
          <%= color_link_with_icon("vote_link", "#", "ui-icon-trash", "Bust Your Vote") %>
        </li>
      </ul>
    <% end%>
  <% end  %>
</div>

<div id="vote_dlg" class="span-17 last">
  <% if @vote_topic.total_votes > 0 %>
    <%= render :partial => "vote_tally"%>
  <% end  %>
</div>

<div id="comments_container">

  <% if current_user.nil? %>
    <%= link_to "Please login to comment", login_path  %>
  <% else %>
    <div id ="comment_form">
      <% form_for ([@vote_topic, Comment.new]) do |f| %>
        <ul>
          <li><%= f.text_area :body, :size => "50x5" %></li>
          <li><%= color_link_with_icon("comment_submit", "#", "ui-icon-trash", "Comment") %></li>
        </ul>
      <% end %>
    </div>
  <% end  %>
  <div id="com_prog_loading" class="progress" style="opacity:0;"></div>
  <div id ="comments">
<%#= will_paginate @comments %>
<%#= render :partial=> "comments/comment", :collection => @comments, :as => :comment %>
<%#= will_paginate @comments %>
    <%= render :partial => "comments/comments" %>
  </div>
</div>
