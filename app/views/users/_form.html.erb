<script type="text/javascript">
  //<![CDATA[
  $(document).ready(function(){
    $('#register_submit').button({icons:{primary:'ui-icon-circle-check'}}).click(function(){
      $('form').submit();
      return false;
    });
  });
  //]]>
</script>
<div><%=  flash[:recaptcha_error] %>
</div>

<% semantic_form_for @user, :html => {:multipart => true} do |form| %>
  <%= form.semantic_errors%>
  <% unless form.object.new_record? %>
    <h3 class="">Edit Profile</h3>
    <div class="ui-widget-header normal-pad prepend-top append-bottom" id="">
      If you do not want to change the password leave the password fields blank.
    </div>
  <% end  %>
  <% form.inputs do  %>
    <% if form.object.new_record? %>
      <li><%= link_to "Already have an account? Please login.", login_path, :class => 'bld big' %></li>
      <li>Fields marked with * are required.</li>
    <% end  %>
    <% if !form.object.using_rpx? %>
      <%= form.input :username, :input_html => {:style => "width:30%"} %>
      <%= form.input :password, :label => form.object.new_record? ? "Password" : "Change password", :input_html => {:style => "width:30%"} %>
      <%= form.input :password_confirmation , :input_html => {:style => "width:30%"}%>
    <% end  %>
    <%= form.input :email, :input_html => {:style => "width:30%"} %>
    <%= form.input :zip, :label => 'Your Zipcode', :input_html => {:style => "width:30%"} %>
    <%= form.input :sex, :as => :radio, :collection => {"M" => 0, "F" => 1} %>
    <%= form.input :age, :as => :select, :collection => Constants::USER_AGE_RANGE.map{|x| [x, x]}, :input_html => {:style => "width:30%"} %>

    <% if !form.object.new_record? %>
      <%= get_user_avatar form.object   %>
    <% end  %>
    <%= form.input :image %>

    <% if form.object.new_record? %>
      <li class="bld">Please enter the text as it appears in the image.</li>
      <li><%= recaptcha_tags :display => {:theme => 'clean'} %></li>
    <% end  %>
  <% end  %>

  <% if @user.new_record? %>
    <%#= rpx_popup( :link_text => ".. or register using RPX", :app_name => Constants::RPX_APP_NAME, :return_url => user_sessions_url, :unobtrusive => false ) %>
  <% else %>
    <div class="prepend-top append-bottom ui-widget-content normal-pad">

      <% if @user.using_rpx? %>
        <p>
          This account is being authenticated by <%= @user.get_rpx_providers %>. If you use any of your <%= @user.unused_rpx_providers  %> accounts to login,
          you can merge those accounts by clicking on the link below. Merging the accounts will keep all your VoteTopic, Comments, Voting Power under one account.

        </p>
        <span class="special-text bld clearfix" id="">
          <%= rpx_popup( :link_text => "Merge Accounts", :app_name => Constants::RPX_APP_NAME, :return_url => addrpxauth_url, :add_rpx => true, :unobtrusive => false ) %>
        </span>
      <% else %>
        <p>
          This account is being authenticated by <%= APP_CONFIG['site_name'] %>. If you would like to use any of your <%= @user.unused_rpx_providers  %> accounts to login,
          you can merge this account with one of those accounts by clicking on the link below. Merging the accounts will keep all your Vote Topics, Comments, Voting Power under one
          account, but you can continue to login using any one of the merged accounts.
        </p>
        <span class="special-text bld clearfix" id="">
          <%= rpx_popup( :link_text => "Add RPX authentication for this account..", :app_name => Constants::RPX_APP_NAME, :return_url => addrpxauth_url, :add_rpx => true, :unobtrusive => false ) %>
        </span>
      <% end %>
    </div>
  <% end %>
  <ul>
    <li>
      <span class=""><button id="register_submit"><%= form.object.new_record? ? "Register" : "Update Profile" %></button></span>
    </li>
  </ul>
<% end  %>