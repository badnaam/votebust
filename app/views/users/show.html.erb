<script type="text/javascript">
  //<![CDATA[
  $(document).ready(function(){
    $('#profile_edit').button({icons:{primary:'ui-icon-key'}})
    $('#tabs').tabs(
    {
      spinner:"<img src='/images/loading.gif'/>",
      ajaxOptions:{
        error:function(xhr, status,index, anchor){
          $(anchor.hash).html("Couldn't load this tab. \n\
        We'll try to fix this as soon as possible.");
        },
        dataType:'script',
        success:function(){
        }
      }
    });


    $('.pagination a').live("click", function () {
      var elementToBeFilled = $(this).parent('.pagination').parent('.ui-tabs-panel').attr('id');
      $(this).addClass('loading-link')
      $.ajax({
        type : 'GET',
        url : this.href,
        complete : function() {
          $(this).removeClass('loading-link')
        },
        dataType : 'script',
        data:"container_name="+elementToBeFilled
      })
      return false;
    });
  });
  //]]>
</script>

<div class="span-18 last">
  <div class="prepend-top normal-pad ui-widget-content append-bottom">
    <% if current_user != @user %>
      <h3 class="prepend-top append-bottom normal-pad ui-widget-header"><%= "#{@user.username}'s Activity" %></h3>
    <% end  %>
    <div id="tabs" class="prepend-top">
      <ul>
        <li><a title ="Your account" href="#user_tab">Profile</a></li>
        <% permitted_to? :update, @user do %>
          <li title="Vote Topics you are tracking"><a   title ="tracked_votes" href="<%= url_for(:controller => :vote_topics, :action => :index,
                                                          :listing_type => "user_tracked_all")%>"><span>Tracking</span></a></li>
          <% end  %>
        <li  title="Votes you have started.">
          <a  title="started_votes" href="<%= url_for(:controller => :vote_topics, :action => :index, :listing_type => 'user_all', :user_id => @user.id)%>">
            <span>Votes Started <span class="" id="">
                <%= @user.posted_vote_topics.size %>
              </span></span>
          </a>
        </li>
        <li  title ="Vote Topics you have voted on">
          <a  title ="voted_votes" href="<%= url_for(:controller => :votes, :action => :index, :listing_type => 'voted', :user_id => @user.id) %>">
            <span>Votes Posted <span class=""><%= @user.votes.size %></span> </span>
          </a>
        </li>
      </ul>

      <div id ="user_tab">
        <ul class="profile-list prepend-top">
          <li class="bld" style="width:150px">
            <%= render :partial => "/shared/ubox_alt", :locals => {:user => @user} %>
          </li>
          <% permitted_to? :update, @user do %>
            <li class="clear">
              Authentication Provider: <%= h @user.using_rpx? ? @user.get_rpx_providers : (t 'site_name') %>
            </li>
            <li>
              Email:
              <%=h @user.email %>
            </li>
            <li>
              Gender:
              <%=h User::SEX[@user.sex] %>
            </li>
            <li>
              Age:
              <%=h @user.age %>
            </li>
            <li>
              Zip:
              <%=h "#{@user.zip} (#{@user.city}, #{@user.state})"   %>
            </li>
            <% permitted_to? :update, @user do %>
              <li>
                <span class="small-button"><%= link_to 'Edit', edit_user_path(@user), :id => 'profile_edit' %></span>
              </li>
            <% end  %>
          </ul>
        </div>
        <div class="" id="tracked_votes"></div>
        <div class="" id="started_votes"></div>
        <div class="" id="voted_votes"></div>
      <% end  %>
    </div>
  </div>
</div>
<div class="push"></div>
